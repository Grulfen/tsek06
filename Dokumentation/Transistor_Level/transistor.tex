\documentclass[a4paper,12pt]{article} \usepackage{graphicx}
\usepackage{epstopdf} %\usepackage{gensymb} \usepackage{longtable}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{morefloats}
\lstset{
        language=verilog,
        basicstyle=\footnotesize,
        breaklines=true
}

\input{../LIPS.tex}

\newcommand{\degree}{\ensuremath{^\circ}}
\newcommand{\LIPSartaltermin}{2013/VT}
\newcommand{\LIPSkursnamn}{TSEK06}
\newcommand{\LIPSprojekttitel}{DLL Based Frequency Multiplier}

\newcommand{\LIPSprojektgrupp}{Group 7}

\newcommand{\LIPSgruppepost}{}
\newcommand{\LIPSgrupphemsida}{} 
\newcommand{\LIPSdokumentansvarig}{Gustav Svensk}

\newcommand{\LIPSkund}{ISY, Linköpings universitet, 581\,83 Linköping}

\newcommand{\LIPSkundkontakt}{Amin Ojani}
\newcommand{\LIPSkursansvarig}{Atila Alvandpour}
\newcommand{\LIPShandledare}{Amin Ojani}

\newcommand{\LIPSdokumenttyp}{Transistor Level Design} 
\newcommand{\LIPSredaktor}{Nora Björklund} 
\newcommand{\LIPSversion}{1.0} 
\newcommand{\LIPSdatum}{\dagensdatum}

\newcommand{\LIPSgranskare}{} 
\newcommand{\LIPSgranskatdatum}{}
\newcommand{\LIPSgodkannare}{} 
\newcommand{\LIPSgodkantdatum}{}

\begin{document}
\LIPStitelsida

%% Argument till \LIPSgruppmedlem: namn, roll i gruppen, telefonnummer, epost
\selectlanguage{swedish}
\begin{LIPSprojektidentitet}
 
\LIPSgruppmedlem{Nora Björklund}{Project leader}{076 7756
789}{norbj648@student.liu.se}
\LIPSgruppmedlem{\LIPSdokumentansvarig}{Documentation}{073
6208776}{grulfen3@gmail.com} 
\LIPSgruppmedlem{Christopher Hallberg}{}{0739845945}{chrha007@student.liu.se} 
\LIPSgruppmedlem{Gustaf Bengtz}{}{0707367307}{gbengtz@gmail.com} 
\LIPSgruppmedlem{Johan Berneland}{}{0704988329}{johbe915@student.liu.se}
\end{LIPSprojektidentitet}

\selectlanguage{english}

\tableofcontents{} 
\newpage %% Argument till \LIPSversionsinfo: versionsnummer, datum, Ändringar,
         %  utfört av,granskat av
\addcontentsline{toc}{section}{Document history}
\begin{LIPSdokumenthistorik} 
        \LIPSversionsinfo{0.1}{}{First draft.}{}{}
\end{LIPSdokumenthistorik} 
\newpage


\section{Block Level and Description}
The system works as in the high level report with the exception that the
multiplication factor cannot be changed anymore. The reason for this is stated
in section \ref{sec:trans_detect}. The design of the lock detector has also been
changed slightly, which can be seen in section \ref{sec:lck_det}.  
An overview of the system can be seen in figure\ref{fig:system}.
\begin{figure}[h]
        \centering
        \includegraphics[width=0.7\textwidth]{../Bilder/DIA_high_level.png}
        \caption{Overview of the system}
        \label{fig:system}
\end{figure}
In figure \ref{fig:system} the buffers between subsystems have been omitted to
make the figure less cluttered. Basically all intermediate signals have been
buffered in the design, using appropriately sized buffers. In the layout three
different supply voltages will probably be used, one for the digitally
controlled delay line, one for the frequency multiplier and one for the rest of
the system.
\subsection{Phase Detector}
The Phase Detector (PD), as seen in Figure \ref{fig:PD}, is a D-flipflop (DFF), as seen in Figure \ref{fig:DFF}, without
reset and inverted output signal.

\begin{figure}[h]
\centering
\includegraphics[width=0.7\textwidth, angle = 270]{../Bilder/Phase_detector_trans.png}
\caption{The Phase Detector}
\label{fig:PD}
\end{figure}

Noteworthy is that the inverter after the first transmission gate has got counterintuitive sizing of the PMOS and NMOS transistors.
Using a NMOS being almost five times wider than the PMOS gives better rise and fall time. Except that, the NMOS are 1/3 the size of the
PMOS, with a fanout of 3. The transistors on the input side were set to being as small as possible, and the size increases towards the
output, to buff the signal before sending it to the next subsystem.

\begin{figure}[h]
\centering
\includegraphics[width=0.7\textwidth, angle = 270]{../Bilder/DFF-1.png}
\caption{D-flipflop}
\label{fig:DFF}
\end{figure}

The sizing of the transistors in the DFF have been found by sweeping on the variables that were interesting.

\subsection{Counter}
The purpose of the counter is to generate the control signals for the delay line.
The counter is a six bit up/down counter with synchronous reset and both
inverted and non inverted outputs. It is controlled by two signals, an enable
signal which is generated by the lock detector and an up/down signal generated
by the phase detector. It is made up of six bitcells and a small logical net to
manage the enable and up/down signal as shown in figure \ref{fig:counter_top}.



\subsubsection{Enable Net}
The enable net is a small logic net that consists of an inverter and two
AND gates. This net generates the input to the bitcell line.
All components in the net are sized to have a path equivalent of a 0.4$\mu$m NMOS
path, and has a PMOS/NMOS size ratio of 3. The net can be seen on the left of the
bitcell in figure \ref{fig:counter_top}.

\begin{figure}[h]
        \centering
        \includegraphics[width=\textwidth]{../Bilder/counter_6bit/counter_6bit_top.png}
        \caption{Enable net and the first bitcell of the counter, the other 5 bitcells are
        left as they add little to understandning the system.}
        \label{fig:counter_top}
\end{figure}

\subsubsection{Bitcell}
Each bitcell is designed as shown in figure \ref{fig:counter_bitcell} and consists of an OR gate 
that controls the t signal of the TFF, two AND gates that generates the carry 
output signals and a TFF that generates the output signals.
The sizing throughout the bitcell, except for the DFF, is done in such a way as 
to minimize all input sizes. All paths are sized to equal a 0.4$\mu$m NMOS path
and the PMOS/NMOS size ratio is set to 3.

\begin{figure}[h]
        \centering
        \includegraphics[width=\textwidth]{../Bilder/counter_6bit/counter_6bit_bitcell.png}
        \caption{Block description of the bitcell.}
        \label{fig:counter_bitcell}
\end{figure}

\subsubsection{TFF and DFF}
The TFF consists of a XOR gate along with a DFF that has a reset input signal and
both intverted and non inverted output signals as seen in figure \ref{fig:counter_TFF}. The sizing of the DFF is inspired 
by the DFF that was described in the labs, but some changes had to be made to satisfy
the requirement of reset and inverted output.

\begin{figure}[h]
        \centering
        \includegraphics[width=\textwidth]{../Bilder/counter_6bit/counter_6bit_TFF.png}
        \caption{Block description of the TFF.}
        \label{fig:counter_TFF}
\end{figure}

\subsection{Digitally Controlled Delay Line}
The Digitally Controlled Delay Line, henceforth called delay line, is the part
that delays the input clock signal. The delay line is divided into eight
identical blocks connected in series. Each block delays
the signal 
$45\degree$ giving a total delay of 360\degree. The delay line can be seen in
figure \ref{fig:del_line}. 

\begin{figure}[h]
        \centering
        \includegraphics[width=\textwidth]{../Bilder/Delay_Line/Delay_line_top.png}
        \caption{Delay Line}
        \label{fig:del_line}
\end{figure}
The input to a delay block is the signal that is going
to be delayed and the control signals from the 6-bit counter. How much a signal
is delayed is set by the counter output. After each block an output signal is sent
through buffers into the frequency multiplier. Because the last output signal
also needs to be fed back to the phase detector, a dummy block consisting of the
first stage of the buffer between delay line and phase detector is needed on
the lower seven output signals. Figure \ref{fig:del_bl} shows the inside of
the delay blocks.
\subsubsection{Delay Block}
\begin{figure}[h]
        \centering
        \includegraphics[width=\textwidth]{../Bilder/Delay_Line/Delay_cell.png}
        \caption{Delay Block}
        \label{fig:del_bl}
\end{figure}
A delay block consists of two delay cells with six bit delays between
them. The delay cells is two inverters that makes up a small buffer with a
tapering factor of 2.5. The delay cell and its sizing can be seen in figure
\ref{fig:del_cell}. 
\begin{figure}[h]
        \centering
        \includegraphics[width=0.8\textwidth]{../Bilder/Delay_Line/Delay_inv.png}
        \caption{Delay Cell}
        \label{fig:del_cell}
\end{figure}
The delay cells contribute to the fixed delay of the delay line and also helps
to drive the signal between the delay blocks. The control signals from the
counter is connected to the delay blocks and controls the variable delay of the
delay line. 
The basic building block of the
bit delay is an NMOS transistor where the drain and source are connected
together with the control signal and where the gate is connected between the two
delay cells. Figure \ref{fig:del_bit} shows the sizing of the NMOS transistor.
\begin{figure}[h]
        \centering
        \includegraphics[width=0.5\textwidth]{../Bilder/Delay_Line/Delay_bit.png}
        \caption{Delay Bit}
        \label{fig:del_bit}
\end{figure}
When connected like this the NMOS transistor works like a capacitor. If the control
signal is low the capacitance is higher than when the control signal is high,
therefore the inverted outputs of the 6-bit counter is used. The goal was to
make the delay binary weighted. To achieve this different numbers of NMOS
transistor is connected in parallel for each control signal. The exact number
can be seen in figure \ref{fig:del_bl}. Note that the indices start at 0, so for
example the first block is called I8<1:0>, meaning that the number of
transistors is two. The corresponding delay when adding more capacitances is
also highly non-linear as reflected by the numbers.

\clearpage

\subsection{Lock Detector}
\label{sec:lck_det}
To avoid that the counter will count up and down to many times and
create a \emph{jitter} and to save power a lock detector has been implemented. The
lock detector detects when the phase error between two signals is
greater than a decided time and then sets its output to low. The
design of the lock detector has been changed slightly from what was
decided in the high-level report since the lock detector works better
with the second design. The design now is from \cite{dll_report},
where the clocks to the d-flip-flops have the same delay. 

\begin{figure}[h]
        \centering
        \includegraphics[width=150mm]{../Bilder/LD_tran/LockDetector.png}
        \caption{Lock detector, block overview}
        \label{fig:LD_block}
\end{figure}


The delay blocks have been implemented with inverters that have been
sized to give proper delay to the two input signals. Figure
\ref{fig:s_delay} - \ref{fig:c_delay} show the transistor schematics of the
delays within the lock detector. The d-flipflop is the same as in the
phase detector and the inverter on the end of the is designed to give
the same delay as the compensation delay

\begin{figure}[h]
        \centering
        \includegraphics[width=150mm]{../Bilder/LD_tran/single_delay.png}
        \caption{Single delay}
        \label{fig:s_delay}
\end{figure}

\begin{figure}[h]
        \centering
        \includegraphics[width=150mm]{../Bilder/LD_tran/double_delay.png}
        \caption{Double delay}
        \label{fig:d_delay}
\end{figure}

\begin{figure}[h]
        \centering
        \includegraphics[width=150mm]{../Bilder/LD_tran/compensation_delay.png}
        \caption{Compensation delay}
        \label{fig:c_delay}
\end{figure}

\clearpage
\subsection{Frequency Multiplier}
The block structure of the frequency multiplier can be seen in figure 
\ref{fig:freq_mult}.
\begin{figure}[p]
        \centering
        \includegraphics[width=0.7\textwidth]{../Bilder/freq_mult_trans.png}
        \caption{Frequency multiplier}
        \label{fig:freq_mult}
\end{figure}

The purpose of the frequency multiplier is to combine the eight delayed signals
to one signal with a frequency that is four times bigger than the input
frequency. This is done by first producing a negative pulse for every rising
edge of the delayed signals. This pulse is produced by the transition detector.
The pulses are then combined to one signal by the edge combiner. The pulse
train is then inputed to the toggle pulsed latch which produces the final output.

The design of the frequency multiplier has changed from the high level report.
This is because the delays in the multiplexer and counter were too high in this
technology, so it was very difficult to reach an output frequency of 1 GHz.

\subsubsection{Transition Detector}
\label{sec:trans_detect}
The transition detector consists of three inverters and a symmetric nand gate.
The purpose of the transition detector is to produce negative pulses for every
rising edge that reaches the input. The transistors are sized so the output
pulse is approximately 230 ps long. The transistor layout can be seen
in figure \ref{fig:trans_detect_trans}.
A buffer is placed at the output of the circuit to improve rise and fall times.
The gates are connected according to figure \ref{fig:trans_detect}.

Earlier designs had a third input to the symmetric nand to control the
multiplication factor of the circuit by only allowing certain pulses to pass.
This was changed because it was difficult to get a 230 ps pulse with full swing
with this design.

\begin{figure}[p]
        \centering
        \includegraphics[width=\textwidth]{../Bilder/trans_detect_trans.png}
        \caption{Transistion Detector, Transistor Level}
        \label{fig:trans_detect_trans}
\end{figure}

\begin{figure}[p]
        \centering
        \includegraphics[width=0.4\textwidth]{../Bilder/trans_detect.png}
        \caption{Transition Detector}
        \label{fig:trans_detect}
\end{figure}

\subsubsection{Edge Combiner}
The purpose of the edge combiner is to combine the negative pulses from the
transition detectors to one pulse. This is done by a network of symmetric and
gates. The design can be seen in figure \ref{fig:edge_comb}. A buffer is used to
improve the rise and fall times of the final signal.
The sizing of the transistors is inspired from \cite{dll_report}.
It is important that the incoming pulses are not too wide to be able to combine
them to a signal. If they are too wide they will be combined to a constant zero,
which will not produce a valid output.

\begin{figure}[p]
        \centering
        \includegraphics[width=0.6\textwidth]{../Bilder/edge_combiner_trans.png}
        \caption{Edge Combiner}
        \label{fig:edge_comb}
\end{figure}

\subsubsection{Toggle Pulsed Latch}
The toggle pulsed latch toggles its output every time a negative pulse arrives
at the input. The input is a train of pulses from the edge combiner and the
output is the multiplied signal which is the final output of the circuit, after
it is buffered. It is important that the pulses on the input is around 200 ps,
if they are too short the latch will not toggle and if they are too long the
latch will toggle more than once. This delay is controlled by the buffer on the
signal that is fed back to the latch. The toggle pulsed latch is a dynamic
circuit so a keeper is used to keep the internal node stable both at a high and
low value.
The transistor layout can be seen in figure \ref{fig:tpl}. The
sizing is inspired from \cite{dll_report}. 
\begin{figure}[p]
        \centering
        \includegraphics[width=\textwidth]{../Bilder/tpl_trans.png}
        \caption{Toggle Pulsed Latch}
        \label{fig:tpl}
\end{figure}

\clearpage
\section{Simulation Result}
The simulations have been run in different process variation corners and
temperatures to examine the behaviour of the circuit. The process variation is
the variations of the NMOS and PMOS between wafers and batches. 
The process variation corners are where the process variations are biggest.
The names of the process variation corners and their meaning can be seen in
table \ref{tab:corners}.

\begin{table}[h]
        \centering
        \begin{tabular}{|l|l|}
                \hline 
                cmostm & Typical Mean - the normal values for PMOS and NMOS \\
                cmoswp & Worst Power - PMOS and NMOS work faster than normal \\
                cmosws & Worst Speed - PMOS and NMOS work slower than normal \\
                cmoswo & Worst One - PMOS is slower than normal and NMOS is
                faster than normal \\
                cmoswz & Worst Zero - PMOS is faster than normal and NMOS is
                slower than normal \\
                \hline
        \end{tabular}
        \caption{Process Variation Corners}
        \label{tab:corners}
\end{table}

\subsection{Whole System Simulation}
Under normal (cmostm) circumstances the system works very well and can
lock and unlock for different frequences as shown in figure
\ref{fig:WS_sim_tm}. In

\begin{figure}[h]
  \centering
  \includegraphics[width=\textwidth]{../Bilder/WS_sim_tm.png}
  \caption{Simulation results under "normal" circumstances (cmostm)}
  \label{fig:WS_sim_tm}
\end{figure}

\subsubsection{Corner simulations}
The relevant results from the corner simulations are presented in
table \ref{tab:WS_corner}. The system works for all corners but
for cmoswp and cmosws the input frequency cannot be 250 MHz since the
change within the delay line and frequency multiplier is too big. 
\begin{table}[h]
        \centering
        \begin{tabular}{|c|c|c|c|c|c|}
                \hline
                \textbf{Corner} & \textbf{f (MHz)} &
                \textbf{Locks after (ns)} & \textbf{lock interval (ps)} & \textbf{Out f
                  (MHz)} & \textbf{Comment} \\
                \hline
                cmostm & 250 & 93  & 28 & 1002 & Can also run at 220 MHz \\
                cmosws & 200 & 27  & 85 & 802  & Does not run at 250 MHz \\
                cmoswp & 290 & 211 & 13 & 1211 & Does not run at 250 MHz \\
                cmoswo & 250 & 72  & 36 & 1000 & Can also run at 220 MHz \\
                cmoswz & 250 & 68  & 43 & 1000 & Can also run at 220 MHz \\
                \hline
        \end{tabular}
        \caption{Corner simulation results}
        \label{tab:WS_corner}
\end{table}
\subsubsection{Temperature simulations}
The system works well for the temperatures 0-70 \degree C, since the
frequency multiplier does not work under 100 \degree C it has not been
tested.
  
\begin{table}[h]
        \centering
        \begin{tabular}{|c|c|c|}
          \hline
          \textbf{\degree C} & \textbf{Locks after (ns)} & \textbf{Comment} \\
          \hline
          0  & 133 & Locks twice during the 200 ns interval \\
          27 & 93  & --- \\
          70 & 37  & The output frequency is slightly uneven due to
          locking a bit early \\
          \hline
        \end{tabular}
        \caption{Temperature simulation results (cmostm)}
        \label{tab:WS_temp}
      \end{table}
In 0 \degree C after the lock goes down the counter counts up once
(since it is not synchronous)the lock detector then unlocks and then
locks again.  
\subsubsection{Power usage}
The power usage for the system and for each block during a 200 ns long
simulation in cmostm conditions can be seen in table
\ref{tab:WS_power}. Voltage is set to 3.3 V for all blocks.
\begin{table}[h]
        \centering
        \begin{tabular}{|c|c|}
                \hline
                \textbf{Block}                & \textbf{Power use (mW)}  \\
                \hline
                System               & 48.27           \\
                Frequency multiplier & 24.35           \\
                Delay line           & 3.472           \\
                Counter              & 0.806           \\
                Lock detector        & 0.782           \\
                Phase detector       & 0.104           \\
                \hline
        \end{tabular}
        \caption{Power usage for the system and each block}
        \label{tab:WS_power}
\end{table}


\subsection{Phase Detector}
The set-up time for the PD, which can be seen in Figure \ref{fig:set_up_PD}, is less than 45 fs
running with a non-ideal clock input, and non-ideal input data.

The set-up time did not change when running any of the tests, but the rise time altered slightly
for two of the set-ups. Except that, the PD worked well for all the tests.

\begin{itemize}
        \item cmostm: works well at 0 degrees.
        \item cmostm: works well at 100 degrees.
        \item cmosws: but the rise time is a little slower.
        \item cmoswp: but the rise time is a little faster.
        \item cmoswo: the rise is roughly the same as for tm.
        \item cmoswz: nothing note-worthy.
\end{itemize}

\begin{figure}[h]
\centering
\includegraphics[width=0.7\textwidth]{../Bilder/set_up_PD.png}
\caption{Set-up time for PD}
\label{fig:set_up_PD}
\end{figure}

The time it takes for the DFF to propagate the signal from the input to the output is 504 ps.

The DFF worked as expected when running all the corner tests, so the most interesting part was the propagation delay for
the different set-ups.

\begin{itemize}
        \item cmostm: The propagation was 464 ps when working at 0 degrees.
        \item cmostm: The propagation was 612 ps when working at 100 degrees.
        \item cmosws: The propagation delay was 778 ps.
        \item cmoswp: The propagation delay was 299 ps.
        \item cmoswo: The propagation delay was 469 ps.
        \item cmoswz: The propagation delay was 489 ps.
\end{itemize}

\subsection{Counter}

The counter has been constructed such that it is operating correctly up to 660 MHz at
27$\degree$C and no process variations. The path that fails first is the carry chain,
if that fails, all the lower bits usually works as intended while the top bits fails
one after another as the frequency increases. There were no failures with the process
variations or temperatures tested. The power consumed by the counter when counting was
recorded for all conditions simulated, the difference was in the range of 0.1 mW. The
difference in power consumption between when the counter is locked and unlocked was
recorded at 27$\degree$C and the results can be seen in table \ref{tab:counter_lock}.

\begin{table}[h]
        \centering
        \begin{tabular}{|c|c|}
                \hline
                \textbf{Status} & \textbf{Power Consumption [mW]}\\
                \hline
                Locked & 1.31\\
                Unlocked & 0.47\\
                \hline
        \end{tabular}
        \caption{The power consumption of the counter at 27$\degree$C and no corners.}
        \label{tab:counter_lock}
\end{table}

\subsection{Digitally Controlled Delay Line}
Figure \ref{fig:delay_white} shows the simulation result of the delay line in
250 MHz. The first signal is the input signal to the delay line, followed by the
eight delayed output signals. The control bits has been set so that the last
output is delayed 360\degree C. 
\begin{figure}[h]
        \centering
        \includegraphics[width=\textwidth]{../Bilder/Delay_Line/delay_trans_sim_white.png}
        \caption{Simulation result of the Delay Line in 250 MHz}
        \label{fig:delay_white}
\end{figure}

The delay line is highly sensitive to process variations as can be
seen in the figures showing the delay for each control bit. Five
different combinations of process variation corners and temperatures
were chosen to test how much the input signal was delayed. Figure
\ref{fig:CMOSTM} shows the simulation result for CMOSTM in 27 \degree
C. Figures \ref{fig:CMOSTM0} and \ref{fig:CMOSTM100} show the
simulation result for CMOSTM in 0 \degree C and 100 \degree C
respectively.  Finally, the CMOSWS and CMOSWP are plotted in figures
\ref{fig:CMOSWS} and \ref{fig:CMOSWP}, both in 27 \degree C. The
CMOSWZ and CMOSWO corners were also simulated but for the delay line
they did not differ as much as the other corner cases and were
therefore omitted in this report.

\begin{figure}[h!]
        \centering
        \includegraphics[width=0.8\textwidth]{../Bilder/Delay_Line/CMOSTM.png}
        \caption{CMOSTM in 27 \degree C}
        \label{fig:CMOSTM}
\end{figure}

\begin{figure}[h!]
        \centering
        \includegraphics[width=0.8\textwidth]{../Bilder/Delay_Line/CMOSTM0.png}
        \caption{CMOSTM in 0 \degree C}
        \label{fig:CMOSTM0}
\end{figure}

\begin{figure}[h!]
        \centering
        \includegraphics[width=0.8\textwidth]{../Bilder/Delay_Line/CMOSTM100.png}
        \caption{CMOSTM in 100 \degree C}
        \label{fig:CMOSTM100}
\end{figure}

\begin{figure}[h!]
        \centering
        \includegraphics[width=0.8\textwidth]{../Bilder/Delay_Line/CMOSWS.png}
        \caption{CMOSWS in 27 \degree C}
        \label{fig:CMOSWS}
\end{figure}\begin{figure}[h!]
        \centering
        \includegraphics[width=0.8\textwidth]{../Bilder/Delay_Line/CMOSWP.png}
        \caption{CMOSWP in 27 \degree C}
        \label{fig:CMOSWP}
\end{figure}

The values shown in the figures are the
delays from the rising edges of the input signal to the rising edges of the
output signal. The values for the falling edge delay may differ from the values
plotted and also for different bits. However, effort has been made to limit the
overall difference since it affects the duty cycle of the delayed output. 
In figure \ref{fig:CMOSWS} it can be seen that the delays are too long to work
properly with an input frequency of 250 MHz. To fix this it is possible to
decrease the input frequency. If using a separate power supply for the delay
line it is possible to increase it to more than the normal 3.3 V which will
also make the delay smaller. In figure \ref{fig:CMOSWP} the delay is instead too
small. For this case it is possible to solve the problem by increasing the input
frequency and reducing the voltage of the power supply.


In the typical case shown in \ref{fig:CMOSTM} the smallest delay achievable is
around 3.3 ns and the largest delay is almost 5.2 ns. The largest step between
two control words is approximately 40 ps. 

\subsection{Lock Detector}
In table \ref{tab:LD_delays_corner} the delays during different
corners can be seen. The interval where the lock detector is locking
can be seen in figure \ref{fig:LD_tm_wp} and \ref{fig:LD_wo_wz}. The
interval when the lock detector \emph{locks} was at first very shifted
which was solved by adding an extra buffer on the delayed clock of
about 50 ps, why that 50 ps delay is needed is not fully clear but the
\emph{lock interval} for all corners and the normal case improves substantially.
\begin{table}[h]
        \centering
        \begin{tabular}{|c|c|c|}
                \hline
                \textbf{Corner} & \textbf{single delay (ps)} &
                \textbf{double delay (ps)} \\
                \hline
                cmostm & 60.4 & 121.2 \\
                cmosws & 85.9 & 174.3 \\
                cmoswp & 37.8 & 73.8  \\
                cmoswo & 63.3 & 118.0 \\
                cmoswz & 53.2 & 111.3 \\
                \hline
        \end{tabular}
        \caption{The delays of the Lock Detector in corner simulations}
        \label{tab:LD_delays_corner}
\end{table}

\begin{figure}
  \centering
\begin{subfigure}[b]{.3\textwidth}
        \centering
        \includegraphics[width=\textwidth]{../Bilder/LD_tran/PD_tm.png}
        \caption{Interval where the lock detector locks during corner cmostm}
\end{subfigure}

\begin{subfigure}[b]{.3\textwidth}
        \centering
        \includegraphics[width=\textwidth]{../Bilder/LD_tran/LD_ws.png}
        \caption{Interval where the lock detector locks during corner cmosws}
\end{subfigure}

\begin{subfigure}[b]{.3\textwidth}
  \centering
        \includegraphics[width=\textwidth]{../Bilder/LD_tran/PD_wp.png}
        \caption{Interval where the lock detector locks during corner cmoswp}
\end{subfigure}
\caption{Plots of the intervals with cmostm, cmosws, cmoswp}
\label{fig:LD_tm_wp}
\end{figure}

\begin{figure}
\centering
\begin{subfigure}[b]{.5\textwidth}
        \centering
        \includegraphics[width=\textwidth]{../Bilder/LD_tran/PD_wo.png}
        \caption{Interval where the lock detector locks during corner cmoswo}
\end{subfigure}

\begin{subfigure}[b]{.5\textwidth}
        \centering
        \includegraphics[width=\textwidth]{../Bilder/LD_tran/PD_wz.png}
        \caption{Interval where the lock detector locks during corner cmoswz}
\end{subfigure}
\caption{Plots of the intervals with cmoswo, cmoswz}
\label{fig:LD_wo_wz}
\end{figure}

The delay in different temperatures is as in table \ref{tab:LD_temperature}
\begin{table}[h]
        \centering
        \begin{tabular}{|c|c|c|}
                \hline
                \textbf{Temperature $\degree$C} & \textbf{single delay
                  (ps)} & \textbf{double delay (ps)} \\
                \hline
                0 & 55.96 & 112.2 \\
                27 & 60.39 & 121.2 \\
                50 & 69.16 & 128.8 \\
                100 & 72.02 & 144.9 \\
                \hline
        \end{tabular}
        \caption{The delays of the Lock Detector in corner simulations}
        \label{tab:LD_temperature}
\end{table}

\clearpage
\subsection{Frequency Multiplier}
The signal that is of biggest importance in the frequency multiplier is the
combined edges. This is because if the pulses are too wide the combination of
them will be constantly low, and if they are too short the combined edges will not
reach full swing. In the simulations focus is put upon the pulse width of the
combined edges. The pulse width should ideally be 120-230 ps for the toggle
pulsed latch to work properly. The values of the pulse width for the
different corners and temperatures can be seen in table \ref{tab:pulsewidth_corn} and
\ref{tab:pulsewidth_temp}. To get the frequency multiplier to work in the
cmosws corner the input frequency and the supply voltage can be adjusted.
The output, combined edges, a single pulse and input can be seen in figure
\ref{fig:freq_mult_signals}.

\begin{table}[h]
        \centering
        \begin{tabular}{|c|c|}
                \hline
                \textbf{Corner} & \textbf{Pulse Width (ps)} \\
                \hline
                cmostm & 199.1 \\
                cmoswo & 139.1 \\
                cmoswz & 207.7 \\
                cmoswp & 118.3 \\
                cmosws & Not Working \\
                \hline
        \end{tabular}
        \caption{Pulse width of combined edges at 250 MHz and 3.3 V supply voltage, Corners}
        \label{tab:pulsewidth_corn}
\end{table}

\begin{table}[h]
        \centering
        \begin{tabular}{|c|c|}
                \hline
                \textbf{Temperature ($\degree$C)} & \textbf{Pulse Width (ps)} \\
                \hline
                0 & 181.8 \\
                27 & 190.8 \\
                70 & 226.2 \\
                \hline
        \end{tabular}
        \caption{Pulse width of combined edges at 250 MHz and 3.3 V supply voltage, Temperatures}
        \label{tab:pulsewidth_temp}
\end{table}

\begin{figure}[p]
        \centering
        \includegraphics[width=\textwidth]{../Bilder/freq_mult_signals.png}
        \caption{Simulation of Frequency Multipler}
        \label{fig:freq_mult_signals}
\end{figure}
\clearpage
\section{PAD Assignment} % Early test plan också
%%%TODO skriva allt här!
There will be twelve pad available on the fabricated chip. The input and output
signals of the system are listed in tables \ref{tab:input_sig} and
\ref{tab:output_sig} respectively. 

\begin{table}[h!]
        \centering
        \begin{tabular}{|l|l|}
                \hline
                Vdd (system) & Power supply for the system \\
                Vdd (delay) & Power supply for the delay line \\
                Vdd (freq.) & Power supply for the frequency multiplier \\
                Gnd & Ground \\
                In & Input clock signal \\
                \hline
        \end{tabular}
        \caption{Pad input signals}
        \label{tab:input_sig}
\end{table}
Three different power supplies will probably be used to tune different parts of
the system individually.
\begin{table}[h!]
        \centering
        \begin{tabular}{|l|l|}
               \hline
               Out & The multiplied output of the system \\
               360\_del & The delayed output of the delay line \\
               Lock & The lock signal from the lock detector \\
               Up\_Down & The control signal from phase detector to counter \\
               In\_Out & The output of the input signal, needed for comparison \\
               Edge\_Comb & The edge combiner signal \\
               Bit\_3 & The fourth control signal from the counter\\
               \hline
        \end{tabular}
        \caption{Pad output signals}
        \label{tab:output_sig}
\end{table}

The output signals will be needed to see the internal state of the system as
well as provide the multiplied output signal of the system. In order to see that
the counter is working one of its control signals will be connected to an
output.

\clearpage
\section{Risks and Delays}
This section describes the hazards that threaten the functionality of the
system. This is important to understand potential risks and what to
focus on in the layout.
\subsection{Phase Detector}
The PD manages to run with all the corner simulations, as well as run properly
at 500 MHz. The only thing to note is that the clock needs to be properly buffered.

\subsection{Counter}


\subsection{Digitally Controlled Delay Line}
The delay line is sensitive to process variations as shown in the simulation
section. If process variations affects the delay times too much then this has to
be controlled by changing the supply voltage and input frequency. Another thing
to note is that the delay will probably increase because of the parasitic capacitances of
the interconnect in the layout. It might have been preferable to have a larger
range but with lower resolution. However, with the current design of the delay
line, increasing the range would also increase the smallest delay that can be
achieved. This could cause the system to not work at 250 MHz in the normal case
and it was therefore decided not to try to increase the range. 
\subsection{Lock Detector}
The biggest risks with the lock detector is that it have to lock on
good phase difference interval, and that the lock is similar both when
the 360 degrees delayed clock comes before and after the reference
clock. 
\subsection{Frequency Multiplier}
The risks from the high level report are no longer applicable on the frequency
multiplier since the design has changed. Instead new risks have appeared in the
new design which must be considered in the layout. The first thing to fail when
the frequency is turned up is the edge combiner, which is reasonable since this
is the first place where the higher frequency is handled. One way to combat this
is to make the pulses from the transition detector smaller, but this is
dangerous because then the signal might not reach full swing and it will be more
sensitive to process variations, especially the fast fast corner. With the
current design the slow, slow corner is of highest concern. In this corner the
pulses from the transition detector have a pulse width of 356 ps which is too
long to produce a 1 GHz output. To deal with this the input frequency must be
lowered and the supply voltage increased. In the slow, slow corner the frequency
multiplier works with 200 MHz and 3.6 V as the supply voltage.

The most important things to ensure in the layout is:
\begin{itemize}
        \item Full swing on pulse produced by transition detector
        \item Pulsewidth of pulse produced by transition detector around 200-250 ps
        \item Full swing on output of edge combiner
        \item Full swing on internal nodes in the toggle pulsed latch
\end{itemize}

\newpage 
\appendix 
\newpage

\addcontentsline{toc}{section}{References}
\begin{thebibliography}{99}
        \bibitem{dll_clock}\textit{A Low-Power Digital DLL-Based Clock Generator in Open-Loop Mode - }
                Behzad Mesgarzadeh, Atila Alvandpour \\
                IEEE Journal of Solid-State Circuits. Vol. 44. No. 7. July 2009
        \bibitem{lock_detect}\textit{A 62.5-625-Mhz Anti-Reset All-Digital Delay-Locked Loop - }
                Shao-Ku Kao, Bo-Jiun Chen and Shen-Iuan Liu \\
                IEEE Transations on Circuits and Systems - II: Express Briefs, Vol. 54 No. 7, July 2007
        \bibitem{dll_report}\textit{DLL-Based Frequency Multiplier - }
                Layout Edition 2008-05-25 

\end{thebibliography}
\end{document} 
% Local Variables: %%% mode: latex %%% TeX-master: t %%% End:
